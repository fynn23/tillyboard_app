import{_ as w,c as h,o as _,a as m,aD as u,t as L,aM as b,B as y,e as E,i as a}from"./main-D64oKWwd.js";import{e as g}from"./wwElement-C-Z9U7JL.js";import{e as F}from"./wwElement-DAqNRCar.js";import{e as v,a as M,b as k,c as A,d as D,f as P,g as O,h as j,i as S,j as I}from"./wwElement-DGFGyvX1.js";import{e as T}from"./wwElement-VaScUJgb.js";import{e as R}from"./wwElement-DNMqjI6D.js";import{e as C,s as U}from"./wwSection-BMxKAo86.js";import{e as x}from"./wwElement-CM-99sJK.js";import{e as N}from"./wwElement-DuyNLnQD.js";import{e as B}from"./wwElement-BSVOQo0g.js";import{e as z}from"./wwElement-nTX4JhTF.js";import{e as Y}from"./wwElement-Cinjj7fB.js";import{e as $}from"./wwElement-CeQEq0yI.js";import{e as K}from"./wwElement-B5imoK5R.js";import{e as Z}from"./wwElement-B1eJdvL0.js";import{e as V}from"./wwElement-vd3IALzi.js";import{e as W}from"./wwElement-DsxBQTlX.js";import{e as H}from"./wwElement-Ct0l2wh1.js";import{e as G}from"./wwElement-ByX6ybNO.js";import{s as q}from"./wwSection-C9tjFEhz.js";import"./default.css_vue_type_style_index_0_src_true_lang-B0owqiva.js";const X="content",J="lat",Q="lng",ee="color",te="draggable",oe="icon",ne="height",ae="width",se="id",re="type",ie="source",ce="sourceLayer",de="minZoom",le="maxZoom",me="layout",be="paint",pe="filter",he="metadata",_e="id",fe="type",ue="url",we="options",Le={props:{uid:{type:String,required:!0},content:{type:Object,required:!0}},emits:["trigger-event","update:content:effect"],setup(e){const t=E(()=>{const r=Number(e.content.lng),l=Number(e.content.lat);return[isNaN(r)?0:r,isNaN(l)?0:l]}),{value:i,setValue:n}=wwLib.wwVariable.useComponentVariable({uid:e.uid,name:"center",type:"object",defaultValue:{lng:t.value[0],lat:t.value[1]},readonly:!0}),{value:o,setValue:s}=wwLib.wwVariable.useComponentVariable({uid:e.uid,name:"instance",type:"object",defaultValue:null,labelOnly:"{Map Instance}",preserveReference:!0,readonly:!0});return{resizeObserver:null,map:null,markerInstances:[],componentKey:0,center:t,variableCenter:i,setCenter:n,variableMap:o,setMap:s}},data(){return{mapContainerId:"",error:""}},mounted(){this.mapContainerId=this.$el.id&&this.$el.id!=""?this.$el.id:"ww-mapbox-"+wwLib.wwUtils.getUid(),!window.__WW_IS_PRERENDER__&&setTimeout(this.loadMap,1)},computed:{mapStyle(){return this.content.mapStyle||this.content.styleUrl},popupOptions(){return{closeButton:!this.content.popupHideCloseButton,closeOnClick:!this.content.popupStayOpenOnClick,closeOnMove:this.content.popupCloseOnMove,maxWidth:this.content.popupMaxWidth||"240px"}},markers(){const e=this.content.markersContentField||X,t=this.content.markersLatField||J,i=this.content.markersLngField||Q,n=this.content.markersColorField||ee,o=this.content.markersDraggableField||te,s=this.content.markersIconField||oe,r=this.content.markersHeightField||ne,l=this.content.markersWidthField||ae,p=wwLib.wwCollection.getCollectionData(this.content.markers);return Array.isArray(p)?p.map(c=>({content:wwLib.resolveObjectPropertyPath(c,e)||"",color:wwLib.resolveObjectPropertyPath(c,n)||this.content.defaultMarkerColor||null,draggable:wwLib.resolveObjectPropertyPath(c,o)||this.content.defaultMarkerDraggable||!1,position:{lat:Number(wwLib.resolveObjectPropertyPath(c,t)||0),lng:Number(wwLib.resolveObjectPropertyPath(c,i)||0)},icon:this.content.customMarker?{img:wwLib.resolveObjectPropertyPath(c,s)||this.content.defaultMarkerIcon||null,height:wwLib.resolveObjectPropertyPath(c,r)||this.content.defaultMarkerHeight||"auto",width:wwLib.resolveObjectPropertyPath(c,l)||this.content.defaultMarkerWidth||"40px"}:null,rawData:c})):[]},sources(){const e=this.content.sourcesIdField||_e,t=this.content.sourcesTypeField||fe,i=this.content.sourcesOptionsField||we,n=this.content.sourcesUrlField||ue,o=wwLib.wwCollection.getCollectionData(this.content.sources);return Array.isArray(o)?o.map(s=>({id:wwLib.resolveObjectPropertyPath(s,e)||"",type:wwLib.resolveObjectPropertyPath(s,t)||"",url:wwLib.resolveObjectPropertyPath(s,n)||"",options:wwLib.resolveObjectPropertyPath(s,i)||{}})):[]},layers(){const e=this.content.layersIdField||se,t=this.content.layersTypeField||re,i=this.content.layersSourceField||ie,n=this.content.layersSourceLayerField||ce,o=this.content.layersMinZoomField||de,s=this.content.layersMaxZoomField||le,r=this.content.layersLayoutField||me,l=this.content.layersPaintField||be,p=this.content.layersFilterField||pe,c=this.content.layersMetadataField||he,f=wwLib.wwCollection.getCollectionData(this.content.layers);return Array.isArray(f)?f.map(d=>({id:wwLib.resolveObjectPropertyPath(d,e)||"",type:wwLib.resolveObjectPropertyPath(d,t)||"",source:wwLib.resolveObjectPropertyPath(d,i)||"",sourceLayer:wwLib.resolveObjectPropertyPath(d,n)||"",minzoom:wwLib.resolveObjectPropertyPath(d,o)||0,maxzoom:wwLib.resolveObjectPropertyPath(d,s)||24,layout:wwLib.resolveObjectPropertyPath(d,r)||{},paint:wwLib.resolveObjectPropertyPath(d,l)||{},filter:wwLib.resolveObjectPropertyPath(d,p)||null,metadata:wwLib.resolveObjectPropertyPath(d,c)||null})):[]}},watch:{"content.apiAccessToken"(e){e&&(this.componentKey+=1,this.$nextTick(()=>{this.loadMap()}))},"content.zoom"(e){this.map&&this.map.setZoom(e)},"content.mapProjection"(e){this.map&&this.map.setProjection(e)},"content.fixedBounds"(e){this.map&&e&&this.fitMarkersBounds()},mapStyle(e){this.map&&this.map.setStyle(e)},center(e){this.map&&this.map.setCenter(e)},markers(){this.loadMarkers()},popupOptions(){this.loadMarkers()},sources(e,t){this.refreshSourcesAndLayers({newSources:e,oldSources:t,newLayers:this.layers,oldLayers:this.layers})},layers(e,t){this.refreshSourcesAndLayers({newLayers:e,oldLayers:t,newSources:this.sources,oldSources:this.sources})}},methods:{loadMap(){if(this.error="",!this.content.apiAccessToken)return;b.accessToken=this.content.apiAccessToken;const e=document.getElementById(this.mapContainerId);this.map&&this.resizeObserver&&this.resizeObserver.unobserve(e),e&&(e.innerHTML=""),this.map=new b.Map({container:this.mapContainerId,style:this.mapStyle,center:this.center,zoom:this.content.zoom,projection:this.content.mapProjection,scrollZoom:this.content.scrollZoom,trackResize:this.content.trackResize,logoPosition:this.content.logoPosition,attributionControl:!1}),this.setMap(y(this.map)),this.map.on("load",()=>this.fireEvent("map:load")),this.map.on("render",()=>this.fireEvent("map:render")),this.map.on("idle",()=>this.fireEvent("map:idle")),this.map.on("style.load",()=>{this.map.setFog({})}),this.map.on("move",()=>this.setCenter(this.map.getCenter())),this.map.on("click",this.handleMapClick),this.map.on("movestart",this.handleMapMove),this.map.on("moveend",this.handleMapMove),this.map.on("dragstart",this.handleMapMove),this.map.on("dragend",this.handleMapMove),this.loadMarkers(),this.map.on("load",()=>{this.refreshSourcesAndLayers({newSources:this.sources,newLayers:this.layers})}),this.map.on("error",t=>{this.error=t.error}),this.resizeObserver=new ResizeObserver(()=>{this.map&&this.map.resize&&this.map.resize(),this.content.fixedBounds&&this.fitMarkersBounds()}),this.resizeObserver.observe(e)},refreshSourcesAndLayers({newSources:e=[],oldSources:t=[],newLayers:i=[],oldLayers:n=[]}){if(this.map)try{for(const o of n)!o.id||!this.map.getLayer(o.id)||this.map.removeLayer(o.id);for(const o of t)!o.id||!this.map.getSource(o.id)||this.map.removeSource(o.id);for(const o of e)o.id&&this.map.addSource(o.id,this.formatSource(o));for(const o of i)o.id&&this.map.addLayer(this.formatLayer(o))}catch(o){wwLib.wwLog.warn("WW-MAPBOX FAILED TO REFRESH SOURCES AND LAYERS",o)}},loadMarkers(){var e,t,i;if(this.map){for(const n of this.markerInstances)n.remove();for(const n of this.markers){const o=document.createElement("img");o.className="marker",o.src=this.formatUrl((e=n.icon)==null?void 0:e.img),o.style.width=(t=n.icon)==null?void 0:t.width,o.style.height=(i=n.icon)==null?void 0:i.height;const s=new b.Marker({color:n.color,draggable:n.draggable,element:n.icon?o:void 0}).setLngLat([n.position.lng,n.position.lat]).addTo(this.map);n.content&&!this.content.disablePopups&&s.setPopup(new b.Popup({...this.popupOptions}).setHTML(n.content)),s.getElement().addEventListener("click",r=>this.handleMarkerClick(n,r)),s.getElement().addEventListener("mouseenter",r=>this.handleMarkerMouseover(n,r)),s.getElement().addEventListener("mouseleave",r=>this.handleMarkerMouseout(n,r)),s.on("dragstart",r=>this.handleMarkerDrag(n,r)),s.on("drag",r=>this.handleMarkerDrag(n,r)),s.on("dragend",r=>this.handleMarkerDrag(n,r)),this.markerInstances.push(s)}this.content.fixedBounds&&this.fitMarkersBounds()}},fitMarkersBounds(){if(!this.map||!this.markers.length)return;if(this.markers.length===1){this.map.flyTo({center:this.markers[0].position,zoom:this.content.zoom});return}const e=new b.LngLatBounds([this.markers[0].position.lng,this.markers[0].position.lat],[this.markers[0].position.lng,this.markers[0].position.lat]),t=this.markers.reduce((i,n)=>i.extend([n.position.lng,n.position.lat]),e);this.map.fitBounds(t,{padding:20})},handleMarkerClick(e,t){this.$emit("trigger-event",{name:"marker:click",event:{marker:e,domEvent:t}})},handleMarkerMouseover(e,t){this.$emit("trigger-event",{name:"marker:mouseover",event:{marker:e,domEvent:t}})},handleMarkerMouseout(e,t){this.$emit("trigger-event",{name:"marker:mouseout",event:{marker:e,domEvent:t}})},handleMarkerDrag(e,t){this.$emit("trigger-event",{name:"marker:"+t.type,event:{marker:e,lngLat:t.target._lngLat}})},handleMapMove(e){this.$emit("trigger-event",{name:"map:"+e.type,event:{lngLat:this.map.getCenter()}})},handleMapClick(e){this.$emit("trigger-event",{name:"map:click",event:{...e,domEvent:e.originalEvent}})},formatSource(e){const t={...e,...e.options||null};return delete t.id,delete t.options,["geojson","video"].includes(t.type)&&delete t.url,t},formatUrl(e){return typeof e!="string"?null:e.startsWith("designs/")?`${wwLib.wwUtils.getCdnPrefix()}${e}`:`${e}`},formatLayer(e){const t={...e};return t.filter||delete t.filter,t},fireEvent(e){this.$emit("trigger-event",{name:e,event:null})}}},ye={key:0,class:"map-placeholder"},Ee={key:1,class:"map-placeholder"},ge={class:"placeholder-content"},Fe=["id"];function ve(e,t,i,n,o,s){return i.content.apiAccessToken.length?o.error?(_(),h("div",Ee,[m("div",ge,L(o.error),1)])):(_(),h("div",{id:o.mapContainerId,key:n.componentKey},null,8,Fe)):(_(),h("div",ye,t[0]||(t[0]=[m("div",{class:"placeholder-content"},[u(" If you want to use a Mapbox map, you need a valid API access token. If you already have one, you can add it in the map settings. "),m("br"),m("br"),u(" Otherwise you can find the token on your mapbox account page: "),m("a",{href:"https://account.mapbox.com/",target:"_blank"},[m("button",null,"Mapbox account")])],-1)])))}const Me=w(Le,[["render",ve],["__scopeId","data-v-3230bfb5"]]);a.component("wwobject-0d3e75d1-9e77-44cb-a272-8b0825fbc5da",g);a.component("wwobject-14723a21-0178-4d92-a7e9-d1dfeaec29a7",F);a.component("wwobject-1b1e2173-9b78-42cc-a8ee-a6167caea340",v);a.component("wwobject-1ba25bdf-dee9-4e0e-a0b8-b3f3128c3b65",M);a.component("wwobject-1d0468f8-4d33-46fb-9c58-b3742aa7d55a",Me);a.component("wwobject-21881619-a984-4847-81a9-922c3dbb5853",T);a.component("wwobject-3265984a-eb92-4d73-b702-dbd0e4d1472e",R);a.component("wwobject-3a7d6379-12d3-4387-98ff-b332bb492a63",C);a.component("wwobject-53401515-b694-4c79-a88d-abeecb1de562",x);a.component("wwobject-6145eb60-0af8-4e52-bcc6-dc0f6743654e",k);a.component("wwobject-61825dc3-96de-46e1-a8c4-b091289d8448",N);a.component("wwobject-69d0b3ef-b265-494c-8cd1-874da4aa1834",B);a.component("wwobject-6ba133b6-a444-414f-93a5-25cd237dd398",z);a.component("wwobject-6f8796b1-8273-498d-95fc-7013b7c63214",Y);a.component("wwobject-700d9467-e29c-4129-b103-664e9d8611dd",$);a.component("wwobject-83d890fb-84f9-4386-b459-fb4be89a8e15",K);a.component("wwobject-9202d35c-2813-45bc-a7f3-0adb85f83e5e",Z);a.component("wwobject-9256b033-f4e8-4ab4-adce-dac3a940d7f5",V);a.component("wwobject-9ecb2cfc-cef7-4be8-b736-3e17a3b7e9ff",A);a.component("wwobject-a6cb6a4d-6af7-4cd6-b530-a15d9ec64488",D);a.component("wwobject-aa27b26f-0686-4c29-98c5-8217044045b7",W);a.component("wwobject-af811adf-94d9-49dd-ab22-e2f29ae30299",H);a.component("wwobject-b783dc65-d528-4f74-8c14-e27c934c39b1",P);a.component("wwobject-c6c0c00e-49fd-4cb9-bd78-5bc09945721e",O);a.component("wwobject-d7904e9d-fc9a-4d80-9e32-728e097879ad",j);a.component("wwobject-deb10a01-5eef-4aa1-9017-1b51c2ad6fd0",S);a.component("wwobject-f4c24d06-bc88-4b62-add3-4d1f8b42221c",I);a.component("wwobject-fd8c482f-532c-4aeb-a7ae-6904a6b62a1b",G);a.component("section-99586bd3-2b15-4d6b-a025-6a50d07ca845",U);a.component("section-ef0ecc71-9a59-4eab-94b0-b36d66d3d61d",q);
