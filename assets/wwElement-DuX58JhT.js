import{_ as d,D as p,c as m,o as c,H as g,a as f,S as o}from"./main-wZxHusq7.js";const h={props:{content:{type:Object,required:!0},uid:{type:String,required:!0},wwElementState:{type:Object,required:!0}},emits:["trigger-event","add-state","remove-state"],setup(t){const{value:e,setValue:i}=wwLib.wwVariable.useComponentVariable({uid:t.uid,name:"value",defaultValue:null,componentType:"element",type:"file",readonly:!0,resettable:!0});return wwLib.wwVariable.useComponentVariable({uid:t.uid,name:"progress",defaultValue:0,componentType:"element",type:"number",readonly:!0}),{variableValue:e,setValue:i}},data(){return{isDragging:!1}},computed:{required(){return this.content.required&&!this.variableValue},isEditing(){return!1},value(){return this.variableValue},accept(){switch(this.content.accept){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";case"pdf":return".pdf";case"csv":return".csv";case"excel":return".xls,.xlsb,.xlsm,.xlsx";case"word":return".doc,.docm,.docx";case"json":return".json";case"custom":return this.content.acceptCustom;case"any":default:return""}},isReadonly(){return this.wwElementState.props.readonly===void 0?this.content.readonly:this.wwElementState.props.readonly}},watch:{isReadonly:{immediate:!0,handler(t){t?this.$emit("add-state","readonly"):this.$emit("remove-state","readonly")}},isDragging:{immediate:!0,handler(t){t?this.$emit("add-state","drop"):this.$emit("remove-state","drop")}}},methods:{drop(t){var r;this.isDragging=!1;const e=(r=t.dataTransfer)==null?void 0:r.files;if(!e)return;const i=[...e].map(n=>new File([n],n.name,{type:n.type})),l=i.filter(n=>{if(this.accept){const a=this.accept.split(",");for(const u of a)if(n.name.trim().toLowerCase().endsWith(u.trim())||n.type.trim().toLowerCase()===u.replace(".","").trim())return!0}else return!0;return!1}),s=i.filter(n=>!l.includes(n));if(s.length){const n=this.content.multiple;this.$emit("trigger-event",{name:"invalidFile",event:{domEvent:t,value:n?s:s[0]}})}this.handleFiles(t,l)},handleManualInput(t){this.handleFiles(t,[...this.$refs.inputFile.files])},handleFiles(t,e){if(!e||!e.length)return;const i=this.content.multiple;this.setValue(i?e:e[0]),this.$emit("trigger-event",{name:"change",event:{domEvent:t,value:i?e:e[0]}})},openFileExplorer(){this.isEditing||this.isReadonly||this.$refs.inputFile.click()},onDragEnter(t){this.isEditing||this.isReadonly||(t.preventDefault(),t.stopPropagation(),this.isDragging=!0)},onDragLeave(t){this.isEditing||this.isReadonly||(t.preventDefault(),t.stopPropagation(),this.isDragging=!1)},onDragOver(t){this.isEditing||this.isReadonly||(t.preventDefault(),t.stopPropagation())}}},v=["value","name","required","readonly","multiple","accept"];function y(t,e,i,l,s,r){const n=p("wwLayout");return c(),m("div",{class:"ww-input-file-drop",onClick:e[1]||(e[1]=(...a)=>r.openFileExplorer&&r.openFileExplorer(...a)),onDragenter:e[2]||(e[2]=(...a)=>r.onDragEnter&&r.onDragEnter(...a)),onDragleave:[e[3]||(e[3]=(...a)=>r.onDragLeave&&r.onDragLeave(...a)),e[4]||(e[4]=o(()=>{},["prevent"]))],onDragover:e[5]||(e[5]=(...a)=>r.onDragOver&&r.onDragOver(...a)),onDrop:e[6]||(e[6]=o(a=>r.drop(a),["prevent"]))},[g(n,{class:"ww-input-file-drop__layout",path:"layout"}),f("input",{ref:"inputFile",value:t.localValue,class:"ww-input-file-drop__input",type:"file",name:i.wwElementState.name,required:r.required,readonly:r.isReadonly,multiple:i.content.multiple,accept:r.accept,onInput:e[0]||(e[0]=a=>r.handleManualInput(a))},null,40,v)],32)}const D=d(h,[["render",y],["__scopeId","data-v-b964e819"]]);export{D as e};
