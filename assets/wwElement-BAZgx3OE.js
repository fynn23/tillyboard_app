import{s as v}from"./default.css_vue_type_style_index_0_src_true_lang-B0owqiva.js";import{_ as g,D as h,j as m,o as c,m as a,c as T,H as p,b as O,S as E,F as C,az as V,J as d,a as w,d as L,e as b,p as k}from"./main-D64oKWwd.js";const _={props:{content:{type:Object,required:!0},option:{type:Object,required:!0},layoutType:{type:String,required:!0},tagElement:{type:Object,required:!0},flexboxElement:{type:Object,required:!0},isReadOnly:{type:Boolean,required:!0}},data(){return{observer:null,optionStates:[]}},mounted(){const e=this.$el.parentElement;e&&(this.observer=new MutationObserver(n=>{for(const t of n){const o=t.target.getAttribute(t.attributeName);this.$nextTick(()=>{this.handleOptionState(o)})}}),this.observer.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:["class"]}))},methods:{handleOptionState(e){!e||typeof e!="string"||(e.includes("is-pointed")&&!e.includes("is-selected")?this.optionStates=[":hover"]:!e.includes("is-pointed")&&e.includes("is-selected")?this.optionStates=["Selected"]:e.includes("is-pointed")&&e.includes("is-selected")?this.optionStates=["Selected:hover"]:this.optionStates=[])}},beforeUnmount(){this.observer&&this.observer.disconnect()}};function I(e,n,t,o,l,i){const r=h("wwElement");return t.layoutType==="text"?(c(),m(r,a({key:0,class:"multiselect-tag-el"},t.tagElement,{"ww-props":{text:t.option.label||""},states:l.optionStates}),null,16,["ww-props","states"])):(c(),m(r,a({key:1,class:"multiselect-tag-el free-layout"},t.flexboxElement,{states:l.optionStates}),null,16,["states"]))}const F=g(_,[["render",I]]),q={props:{content:{type:Object,required:!0},option:{type:Object,required:!0},layoutType:{type:String,required:!0},tagElement:{type:Object,required:!0},selectedFlexboxElement:{type:Object,required:!0},removeTagIconElement:{type:Object,required:!0},handleTagRemove:{type:Object,required:!0},isReadOnly:{type:Boolean,required:!0},isEditing:{type:Boolean,required:!0}},data(){return{observer:null,optionStates:[]}},mounted(){const e=this.$el.parentElement;e&&(this.observer=new MutationObserver(n=>{for(const t of n){const o=t.target.getAttribute(t.attributeName);this.$nextTick(()=>{this.handleOptionState(o)})}}),this.observer.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:["class"]}))},methods:{handleOptionState(e){!e||typeof e!="string"||(e.includes("is-pointed")&&!e.includes("is-selected")?this.optionStates=[":hover"]:!e.includes("is-pointed")&&e.includes("is-selected")?this.optionStates=["Selected"]:e.includes("is-pointed")&&e.includes("is-selected")?this.optionStates=["Selected:hover"]:this.optionStates=[])}},beforeUnmount(){this.observer&&this.observer.disconnect()}};function A(e,n,t,o,l,i){const r=h("wwElement");return t.layoutType==="text"?(c(),T(C,{key:0},[p(r,a({class:"multiselect-tag-el"},t.tagElement,{"ww-props":{text:t.option.label||""},states:l.optionStates}),null,16,["ww-props","states"]),t.isReadOnly?O("",!0):(c(),m(r,a({key:0,onMousedown:n[0]||(n[0]=E(y=>t.isEditing?null:t.handleTagRemove(t.option,y),["prevent"]))},t.removeTagIconElement),null,16))],64)):(c(),m(r,a({key:1,class:"multiselect-tag-el free-layout"},t.selectedFlexboxElement,{states:l.optionStates}),null,16,["states"]))}const R=g(q,[["render",A]]),P="label",j="value",B={components:{Multiselect:v,OptionItem:F,OptionItemSelected:R},emits:["trigger-event","update:content:effect","add-state","remove-state"],props:{uid:{type:String,required:!0},content:{type:Object,required:!0},wwElementState:{type:Object,required:!0}},setup(e,{emit:n}){const{value:t,setValue:o}=wwLib.wwVariable.useComponentVariable({uid:e.uid,name:"currentSelection",type:"array",defaultValue:b(()=>Array.isArray(e.content.initialValue)?e.content.initialValue:[])}),l=k("componentStyle"),i=b(()=>l.cursor);return{currentSelection:t,setCurrentSelection:o,cursor:i}},data:()=>({options:[],componentKey:0}),created(){this.init()},computed:{currentLang(){return wwLib.wwLang.lang},isEditing(){return!1},layoutType(){return this.content.layoutType?this.content.layoutType:"text"},uniqueOptions(){const e=new Map;return[...this.options,...this.currentSelection].forEach(n=>{if(n&&typeof n=="object"&&"value"in n)e.set(n.value,n);else if(n!=null){const t=this.options.find(o=>o&&o.value===n);t?e.set(t.value,t):e.set(n,n)}}),[...e.values()]},multiselectProps(){return{options:this.uniqueOptions,closeOnSelect:this.content.closeOnSelect,searchable:this.content.searchable,mode:this.content.mode,multipleLabel:e=>(wwLib.wwLang.getText(this.content.multipleLabel)||`{count} option${e.length===1?"":"s"} selected`).replace("{count}",e.length),noOptionsText:this.content.noOptionsText,noResultsText:this.content.noResultsText,disabled:this.isReadOnly||this.content.disabled,required:this.content.required,hideSelected:this.content.hideSelected,placeholder:"placeholder",createOption:this.content.allowCreation,canClear:this.content.clearIcon,caret:this.content.caretIcon,name:this.wwElementState.name,infinite:this.content.infiniteScroll,limit:this.content.limitedOptions?this.content.limit:-1,max:this.content.maxSelection?this.content.max:-1,resolveOnLoad:!1,locale:this.currentLang}},internalValue:{get(){return Array.isArray(this.currentSelection)?this.currentSelection:[]},set(e){this.setCurrentSelection(e),this.$emit("trigger-event",{name:"change",event:{domEvent:{},value:e}})}},placeholder(){return wwLib.wwLang.getText(this.content.placeholder)},defaultTagStyle(){return this.layoutType==="text"?{backgroundColor:this.content.tagsDefaultBgColor,color:this.content.tagsDefaultTextColor}:{backgroundColor:"transparent"}},cssVariables(){return{"--ms-dropdown-bg":this.content.dropdownBackgroundColor,"--ms-dropdown-border-width":this.content.dropdownBorderWidth||"0px","--ms-dropdown-border-color":this.content.dropdownBorderColor,"--ms-dropdown-radius":this.content.dropdownBorderRadius||"0px","--ms-max-height":this.content.dropdownMaxHeight||"10rem","--ms-option-bg-pointed":this.content.optionBackgroundPointed,"--ms-option-bg-selected":this.content.optionBackgroundSelected,"--ms-option-bg-selected-pointed":this.content.optionBackgroundSelectedPointed,"--ms-bg-disabled":this.isReadOnly?"transparent":null,"--ms-bg":"transparent","--ms-radius":"0","--ms-spinner-color":this.content.loadingRingColor,"--search-font-size":this.content.searchFontSize||"inherit","--search-font-family":this.content.searchFontFamily||"inherit","--search-font-color":this.content.searchFontColor||"inherit","--component-cursor":this.cursor||"pointer","--padding-tag":this.content.layoutType==="text"?"4px":"0"}},isReadOnly(){return this.wwElementState.props.readonly===void 0?this.content.readonly:this.wwElementState.props.readonly}},watch:{"content.initialValue"(){JSON.stringify(this.content.initialValue)!==JSON.stringify(this.internalValue)&&(this.refreshInitialValue(),this.$emit("trigger-event",{name:"initValueChange",event:{value:this.content.initialValue}}))},uniqueOptions:{deep:!0,handler(){var e;(e=this.$refs.multiselect)!=null&&e.isOpen||this.componentKey++}},"content.options":{deep:!0,handler(){this.componentKey++,this.refreshOptions()}},internalValue(){this.refreshOptions()},"content.labelField"(){this.componentKey++,this.refreshOptions()},"content.valueField"(){this.componentKey++,this.refreshOptions()},"content.layoutType"(){this.componentKey++,this.refreshOptions()},isReadOnly:{immediate:!0,handler(e){e?this.$emit("add-state","readonly"):this.$emit("remove-state","readonly")}},"content.limit"(){this.componentKey+=1,this.$nextTick(()=>{this.init()})},currentLang(){this.options=this.options.map(e=>this.formatOption(e.data)),this.componentKey++,this.refreshOptions()}},methods:{init(){const e=Array.isArray(this.content.options)?[...this.content.options]:[];if(this.options.push(...e.map(n=>this.formatOption(n))),this.content.initialValue!==void 0){const n=Array.isArray(this.content.initialValue)?[...this.content.initialValue]:[];this.options.push(...n.filter(t=>!this.options.map(o=>o.value).includes(t))),this.setCurrentSelection(n)}},refreshOptions(){if(!this.options||!Array.isArray(this.options)||!this.internalValue||!Array.isArray(this.internalValue))throw new Error("options or internalValue is not an array");this.options=this.options.filter(t=>t&&this.internalValue.includes(t.value));let e=[];this.content&&Array.isArray(this.content.options)&&(e=[...this.content.options]);const n=e.filter(t=>t&&!this.options.some(o=>o.value===t.value));this.options.push(...n.map(t=>this.formatOption(t))),this.options.push(...this.internalValue.filter(t=>t&&!this.options.some(o=>o.value===t)))},refreshInitialValue(){const e=Array.isArray(this.content.initialValue)?[...this.content.initialValue]:[];this.options.push(...e.filter(n=>!this.options.map(t=>t.value).includes(n)&&!this.currentSelection.includes(n))),this.setCurrentSelection(e)},formatOption(e){let n=this.content.labelField||P;const t=this.content.valueField||j,o=`${wwLib.wwLang.getText(wwLib.resolveObjectPropertyPath(e,wwLib.wwLang.getText(n)))}`,l=wwLib.resolveObjectPropertyPath(e,t);return this.layoutType==="free"?{label:o,value:l,data:e}:typeof e=="object"?{label:o,value:l,data:e}:{label:e,value:e,data:e}},getOptionStyle(e){return this.layoutType==="text"?this.defaultTagStyle:null},handleOpening(e){this.$refs.multiselect&&(e?this.$refs.multiselect.open():this.$refs.multiselect.close())},onTagSelected(e){e&&this.$refs.multiselect.open()},getOptionIndex(e){return this.options.indexOf(e)},checkIsOpen(){},getLabel(e,n){return`${wwLib.wwLang.getText(wwLib.resolveObjectPropertyPath(e,wwLib.wwLang.getText(n)))}`},interceptFocus(e){this.isEditing&&(e.target.classList.contains("multiselect-wrapper")||e.target.classList.contains("multiselect-tags-search"))&&(e.stopPropagation(),e.preventDefault())},interceptClick(e){this.isEditing&&(e.target.classList.contains("multiselect-option")||e.target.classList.contains("multiselect-wrapper")||e.target.classList.contains("multiselect-tags-search"))&&(e.stopPropagation(),e.preventDefault())}}};function M(e,n,t,o,l,i){const r=h("wwElement",!0),y=h("OptionItemSelected"),f=h("wwLayoutItemContext"),x=h("OptionItem"),S=h("Multiselect");return c(),m(S,a({ref:"multiselect",modelValue:i.internalValue,"onUpdate:modelValue":n[6]||(n[6]=s=>i.internalValue=s),key:e.componentKey,class:["input-multiselect",{editing:i.isEditing}],style:i.cssVariables},i.multiselectProps,{onClose:i.checkIsOpen,onFocusCapture:i.interceptFocus,onFocusinCapture:i.interceptFocus,onClickCapture:i.interceptClick,onMousedownCapture:i.interceptClick}),V({placeholder:d(()=>[p(r,a({class:"multiselect-placeholder-el"},t.content.placeholderElement,{wwProps:{text:i.placeholder||""},onMousedown:n[0]||(n[0]=s=>i.isEditing&&s.stopPropagation()),onClick:n[1]||(n[1]=s=>i.isEditing&&s.stopPropagation())}),null,16,["wwProps"])]),tag:d(({option:s,handleTagRemove:u})=>[w("div",{class:"multiselect-tag",style:L(i.getOptionStyle(s))},[p(f,{index:i.getOptionIndex(s),item:{},"is-repeat":"",data:s},{default:d(()=>[(c(),m(y,{key:i.getOptionIndex(s),option:s,layoutType:i.layoutType,selectedFlexboxElement:t.content.selectedFlexboxElement,tagElement:t.content.tagElementSelected,removeTagIconElement:t.content.removeTagIconElement,isReadOnly:i.isReadOnly,isEditing:i.isEditing,handleTagRemove:u},null,8,["option","layoutType","selectedFlexboxElement","tagElement","removeTagIconElement","isReadOnly","isEditing","handleTagRemove"]))]),_:2},1032,["index","data"])],4)]),caret:d(()=>[i.multiselectProps.disabled&&i.internalValue.length&&t.content.clearIcon?(c(),m(r,a({key:0,class:"hidden"},t.content.clearIconElement,{onMousedown:n[4]||(n[4]=s=>i.isEditing&&s.stopPropagation())}),null,16)):O("",!0),p(r,a(t.content.caretIconElement,{class:["caret",{hidden:i.isReadOnly}]}),null,16,["class"])]),clear:d(({clear:s})=>[w("div",{onMousedown:n[5]||(n[5]=E(()=>{},["stop"])),style:{zIndex:2}},[p(r,a(t.content.clearIconElement,{onClick:u=>i.isEditing?null:s(u)}),null,16,["onClick"])],32)]),_:2},[t.content.mode==="tags"?{name:"option",fn:d(({option:s})=>[p(f,{index:i.getOptionIndex(s),item:{},"is-repeat":"",data:s},{default:d(()=>[p(x,{option:s,layoutType:i.layoutType,flexboxElement:t.content.flexboxElement,tagElement:t.content.tagElement,isReadOnly:i.isReadOnly,isEditing:i.isEditing,onMousedown:n[2]||(n[2]=u=>i.isEditing&&u.stopPropagation()),onClick:n[3]||(n[3]=u=>i.isEditing&&u.stopPropagation())},null,8,["option","layoutType","flexboxElement","tagElement","isReadOnly","isEditing"])]),_:2},1032,["index","data"])]),key:"0"}:void 0]),1040,["modelValue","style","class","onClose","onFocusCapture","onFocusinCapture","onClickCapture","onMousedownCapture"])}const N=g(B,[["render",M],["__scopeId","data-v-7f5df671"]]);export{N as e};
