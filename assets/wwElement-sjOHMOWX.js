import{_ as L,D as w,c as h,o as m,j as k,b as _,J as g,H as b,m as p,F as C,q as P,d as x,r as D,ay as y,w as f,e as v,O as S}from"./main-BsligTLj.js";const O={props:{content:{type:Object,required:!0},uid:{type:String,required:!0}},emits:["trigger-event","update:content:effect"],setup(t,{emit:a}){const s=D([]),n=y({label:"Uncategorized",value:null,items:[]});S("customHandler",(e,{stack:c,updatedStackItems:u})=>{e.moved&&a("trigger-event",{name:"item:moved",event:{item:e.moved.element,from:c,to:c,oldIndex:e.moved.oldIndex,newIndex:e.moved.newIndex,updatedList:u}}),e.added&&a("trigger-event",{name:"item:moved",event:{item:e.added.element,from:wwLib.resolveObjectPropertyPath(e.added.element,t.content.stackedBy),to:c,oldIndex:null,newIndex:e.added.newIndex,updatedList:u}})});const o=y({});S("customDragHandler",(e,{stack:c})=>o[c]=e);const{setValue:r}=wwLib.wwVariable.useComponentVariable({uid:t.uid,name:"isDragging",type:"boolean",defaultValue:!1,readonly:!0});f(o,e=>{r(Object.values(e).some(c=>c))},{deep:!0});const l=v(()=>Object.values(o).some(e=>e)),d=v(()=>`* { cursor: ${t.content.draggingCursor||"grabbing"} !important; }`),i=wwLib.getFrontDocument().createElement("style");return f(l,e=>{e?(i.appendChild(wwLib.getFrontDocument().createTextNode(d.value)),wwLib.getFrontDocument().body.appendChild(i)):i.remove()},{deep:!0}),{internalStacks:s,uncategorizedStack:n}},computed:{stacks(){const t=wwLib.wwCollection.getCollectionData(this.content.stacks);return Array.isArray(t)?t:[]},items(){const t=wwLib.wwCollection.getCollectionData(this.content.items);return Array.isArray(t)?t:[]},stackConfig(){return{sortable:this.content.sortable,group:"kanban-"+this.uid,itemKey:this.content.itemKey,handle:this.content.customDragHandle?this.content.handleClass||"draggable":null,readonly:this.content.readonly}},kanbanStyle(){return{"--wrap-stacks":this.content.wrapStacks?"wrap":"nowrap"}},isReadonly(){return this.content.readonly}},watch:{"content.stackValue"(){this.refreshStacks()},"content.stackedBy"(){this.refreshStacks()},"content.sortedBy"(){this.refreshStacks()},"content.sortOrder"(){this.refreshStacks()},"content.stacks":{handler(){this.refreshStacks()},deep:!0},stacks(){this.refreshStacks()},items:{handler(){this.refreshStacks()},deep:!0},isReadonly:{immediate:!0,handler(t){t?this.$emit("add-state","readonly"):this.$emit("remove-state","readonly")}}},methods:{refreshStacks(){this.internalStacks=this.stacks.map(a=>({label:wwLib.resolveObjectPropertyPath(a,this.content.stackLabel||"label")??"",value:wwLib.resolveObjectPropertyPath(a,this.content.stackValue||"value")??""})).map(a=>({...a,items:this.items.filter(s=>wwLib.resolveObjectPropertyPath(s,this.content.stackedBy)===a.value).sort((s,n)=>{if(!this.content.sortedBy)return 0;const o=wwLib.resolveObjectPropertyPath(s,this.content.sortedBy),r=wwLib.resolveObjectPropertyPath(n,this.content.sortedBy);return this.content.sortOrder==="asc"?o>r?1:-1:o>r?-1:1})}));const t=this.stacks.map(a=>wwLib.resolveObjectPropertyPath(a,this.content.stackValue||"value"));this.uncategorizedStack.items=this.items.filter(a=>!t.includes(wwLib.resolveObjectPropertyPath(a,this.content.stackedBy)))}},created(){this.refreshStacks()}};function j(t,a,s,n,o,r){const l=w("wwElement",!0),d=w("wwLayoutItemContext");return m(),h("div",{class:"ww-kanban",style:x(r.kanbanStyle)},[s.content.uncategorizedStack?(m(),k(d,{key:0,index:0,item:null,data:n.uncategorizedStack,"is-repeat":""},{default:g(()=>[b(l,p(s.content.stackElement,{"ww-props":{...r.stackConfig,items:n.uncategorizedStack.items,stack:null},class:"ww-kanban-stack",states:t.isDragging?["dragging"]:[]}),null,16,["ww-props","states"])]),_:1},8,["data"])):_("",!0),(m(!0),h(C,null,P(n.internalStacks,(i,e)=>(m(),k(d,{key:"ww-stack-"+e,index:e,item:null,"is-repeat":"",data:i,"repeated-items":n.internalStacks},{default:g(()=>[b(l,p({ref_for:!0},s.content.stackElement,{"ww-props":{...r.stackConfig,items:i.items,stack:i.value},class:"ww-kanban-stack",states:t.isDragging?["dragging"]:[]}),null,16,["ww-props","states"])]),_:2},1032,["index","data","repeated-items"]))),128))],4)}const I=L(O,[["render",j],["__scopeId","data-v-c356e104"]]);export{I as e};
