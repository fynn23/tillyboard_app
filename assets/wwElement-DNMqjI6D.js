import{_ as k,c as y,o as c,a as n,b as m,n as p,aD as f}from"./main-D64oKWwd.js";var v=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var l,s,o;if(Array.isArray(e)){if(l=e.length,l!=t.length)return!1;for(s=l;s--!==0;)if(!r(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),l=o.length,l!==Object.keys(t).length)return!1;for(s=l;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[s]))return!1;for(s=l;s--!==0;){var a=o[s];if(!r(e[a],t[a]))return!1}return!0}return e!==e&&t!==t};const h="__googleMapsScriptId";class i{constructor({apiKey:e,channel:t,client:l,id:s=h,libraries:o=[],language:a,region:d,version:u,mapIds:g,nonce:T,retries:b=3,url:w="https://maps.googleapis.com/maps/api/js"}){if(this.CALLBACK="__googleMapsCallback",this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.version=u,this.apiKey=e,this.channel=t,this.client=l,this.id=s||h,this.libraries=o,this.language=a,this.region=d,this.mapIds=g,this.nonce=T,this.retries=b,this.url=w,i.instance){if(!v(this.options,i.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(i.instance.options)}`);return i.instance}i.instance=this,this.reset=()=>{i.instance=null}}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url}}createUrl(){let e=this.url;return e+=`?callback=${this.CALLBACK}`,this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),e}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(l=>{l?t(l):e()})})}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){if(document.getElementById(this.id)){this.callback();return}const e=this.createUrl(),t=document.createElement("script");t.id=this.id,t.type="text/javascript",t.src=e,t.onerror=this.loadErrorCallback.bind(this),t.defer=!0,t.async=!0,this.nonce&&(t.nonce=this.nonce),document.head.appendChild(t)}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}resetIfRetryingFailed(){const e=this.retries+1;this.done&&!this.loading&&this.errors.length>=e&&(this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[])}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);wwLib.wwLog.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.onerrorEvent=e,this.callback()}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){window.google&&window.google.maps&&window.google.maps.version&&this.callback(),this.resetIfRetryingFailed(),this.done?this.callback():this.loading||(this.loading=!0,this.setCallback(),this.setScript())}}const x=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],_=[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}],E=[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}],M=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],L=[{elementType:"geometry",stylers:[{color:"#1d2c4d"}]},{elementType:"labels.text.fill",stylers:[{color:"#8ec3b9"}]},{elementType:"labels.text.stroke",stylers:[{color:"#1a3646"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#64779e"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#334e87"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#023e58"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#283d6a"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6f9ba5"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#023e58"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#3C7680"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#304a7d"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#2c6675"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#255763"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#b0d5ce"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#023e58"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#283d6a"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#3a4762"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0e1626"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#4e6d70"}]}],I={silver:x,retro:_,dark:E,night:M,aubergine:L},A="name",F="lat",C="lng",K="url",O="width",S="height",P={props:{content:{type:Object,required:!0},wwElementState:{type:Object,required:!0}},emits:["trigger-event","update:content:effect"],setup(){return{markerInstances:[]}},data(){return{map:null,loader:null,wrongKey:!1,observer:null}},computed:{isEditing(){return!1},isError(){return this.content&&this.content.googleKey?!this.isGoogleKeyMatch:!0},isGoogleKeyMatch(){return this.content.googleKey?this.content.googleKey.match(/^(AIza[0-9A-Za-z-_]{35})$/):!1},mapOptions(){return{center:{lat:parseFloat(this.content.lat||0),lng:parseFloat(this.content.lng||0)},zoom:this.content.zoom,styles:this.content.mapStyle==="custom"?JSON.parse(this.content.mapStyleJSON.code):I[this.content.mapStyle],mapTypeId:this.content.defaultMapType,zoomControl:this.content.zoomControl,scaleControl:this.content.scaleControl,rotateControl:this.content.rotateControl,streetViewControl:this.content.streetViewControl,fullscreenControl:this.content.fullscreenControl,mapTypeControl:this.content.mapTypeControl}},markers(){const r=this.content.nameField||A,e=this.content.latField||F,t=this.content.lngField||C,l=this.content.urlField||K,s=this.content.widthField||O,o=this.content.heightField||S;return Array.isArray(this.content.markers)?this.content.markers.map(a=>({content:wwLib.resolveObjectPropertyPath(a,r),position:{lat:parseFloat(wwLib.resolveObjectPropertyPath(a,e)||0),lng:parseFloat(wwLib.resolveObjectPropertyPath(a,t)||0)},rawData:a,url:wwLib.resolveObjectPropertyPath(a,l),width:parseInt(wwLib.resolveObjectPropertyPath(a,s)||0),height:parseInt(wwLib.resolveObjectPropertyPath(a,o)||0)})):[]}},watch:{markers(){this.updateMapMarkers()},mapOptions(){this.initMap()}},mounted(){this.initMap(),this.observer=new IntersectionObserver(r=>{r.some(e=>e.isIntersecting)&&this.content.fixedBounds&&this.setMapMarkerBounds()},{trackVisibility:!0,delay:100}),this.observer.observe(this.$refs.map)},beforeUnmount(){this.observer.disconnect()},methods:{async initMap(){const{googleKey:r}=this.content;if(!this.isGoogleKeyMatch){r&&r.length&&(this.wrongKey=!0),setTimeout(()=>{this.wrongKey=!1},8e3);return}if(this.wrongKey=!1,!!r.length){this.loader||(this.loader=new i({apiKey:r,language:wwLib.wwLang.lang}),await this.loader.load());try{this.map=new google.maps.Map(this.$refs.map,{...this.mapOptions,zoom:this.content.zoom}),this.map.addListener("click",e=>{e.latLng.lat=e.latLng.lat(),e.latLng.lng=e.latLng.lng(),this.$emit("trigger-event",{name:"map:click",event:{...e}})}),this.updateMapMarkers()}catch(e){wwLib.wwLog.error(e)}}},async updateMapMarkers(){if(!(!this.markers||!this.loader)){for(const r of this.markerInstances)r.setMap(null);this.markerInstances=[];for(const r of this.markers)try{const e=r.url&&r.url.startsWith("designs/")?`${wwLib.wwUtils.getCdnPrefix()}${r.url}`:r.url,t=this.content.defaultMarkerUrl&&this.content.defaultMarkerUrl.startsWith("designs/")?`${wwLib.wwUtils.getCdnPrefix()}${this.content.defaultMarkerUrl}`:this.content.defaultMarkerUrl;let l=new google.maps.Marker({position:r.position,map:this.map,icon:this.content.markersIcon?e?{url:e,scaledSize:!this.content.markersAutoSize&&r.width&&r.height?new google.maps.Size(r.width,r.height):!this.content.markersAutoSize&&this.content.defaultMarkerWidth&&this.content.defaultMarkerHeight?new google.maps.Size(this.content.defaultMarkerWidth,this.content.defaultMarkerHeight):void 0}:{url:t,scaledSize:!this.content.markersAutoSize&&this.content.defaultMarkerWidth&&this.content.defaultMarkerHeight?new google.maps.Size(this.content.defaultMarkerWidth,this.content.defaultMarkerHeight):void 0}:{},animation:google.maps.Animation.DROP});if(this.markerInstances.push(l),r.content){const s=new google.maps.InfoWindow({content:r.content,maxWidth:200});l.addListener("mouseover",o=>{this.$emit("trigger-event",{name:"marker:mouseover",event:{marker:r,domEvent:o.domEvent}}),this.content.markerTooltipTrigger==="hover"&&r.content&&s.open(this.map,l)}),l.addListener("mouseout",o=>{this.$emit("trigger-event",{name:"marker:mouseout",event:{marker:r,domEvent:o.domEvent}}),this.content.markerTooltipTrigger==="hover"&&s.close()}),l.addListener("click",o=>{this.$emit("trigger-event",{name:"marker:click",event:{marker:r,domEvent:o.domEvent}}),this.content.markerTooltipTrigger==="click"&&r.content&&s.open(this.map,l)})}}catch(e){wwLib.wwLog.error(e)}this.content.fixedBounds&&this.setMapMarkerBounds()}},setMapMarkerBounds(){if(!this.map||this.markers.length<2)return;const r=new google.maps.LatLngBounds;for(const e of this.markers)r.extend(e.position);this.map.fitBounds(r)}}},$={class:"map-container"},j={class:"placeholder-content"},D={key:0,class:"wrongKey"};function U(r,e,t,l,s,o){return c(),y("div",{class:p(["ww-map",{inactive:o.isEditing&&!o.isError}])},[n("div",$,[o.isError?(c(),y("div",{key:0,class:p(["map-placeholder",{error:o.isError}])},[n("div",j,[e[0]||(e[0]=f(" If you want to use a Google map, you need to have a Google API Key. If you already have one, you can add it in the map settings. ")),e[1]||(e[1]=n("br",null,null,-1)),e[2]||(e[2]=n("br",null,null,-1)),e[3]||(e[3]=f(" Otherwise you can follow theses instructions: ")),e[4]||(e[4]=n("a",{href:"https://developers.google.com/maps/documentation/javascript/get-api-key",target:"_blank"},[n("button",null,"API Key documentation")],-1)),s.wrongKey?(c(),y("span",D,"Your API key has the wrong format")):m("",!0)])],2)):m("",!0),n("div",{ref:"map",class:p(["map",{error:o.isError}])},null,2)])],2)}const R=k(P,[["render",U],["__scopeId","data-v-458bddf4"]]);export{R as e};
