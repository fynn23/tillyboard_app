import{_ as g,D as u,c as o,o as a,H as i,J as h,F as l,b as p,a as n,aD as k,t as y}from"./main-BLqjW_kE.js";const v={props:{plugin:{type:Object,required:!0},settings:{type:Object,required:!0}},emits:["update:settings"],data(){return{isKeyVisible:!1,projects:[],isLoading:!1,storedAccessToken:""}},computed:{isOauth(){var t;return(t=this.settings.privateData.accessToken)==null?void 0:t.startsWith("sbp_oauth")},connectionMode(){return this.settings.privateData.connectionMode},accessToken(){return this.settings.privateData.accessToken}},mounted(){var t,e,c,r;!this.settings.privateData.accessToken&&((r=(c=(e=(t=wwLib.wwPlugins)==null?void 0:t.supabase)==null?void 0:e.settings)==null?void 0:c.privateData)!=null&&r.accessToken)&&this.changeAccessToken(wwLib.wwPlugins.supabase.settings.privateData.accessToken)},methods:{changeConnectionMode(t){this.$emit("update:settings",{...this.settings,privateData:{...this.settings.privateData,connectionMode:t,accessToken:t==="custom"?"":this.storedAccessToken}})},changeAccessToken(t){this.$emit("update:settings",{...this.settings,privateData:{...this.settings.privateData,accessToken:t}}),this.storedAccessToken=t},async connect(){this.isLoading=!0;const t=window.location.origin+window.location.pathname;window.localStorage.setItem("supabase_oauth",!0);const{data:e}=await wwAxios.post(`${wwLib.wwApiRequests._getPluginsUrl()}/designs/${wwLib.$store.getters["websiteData/getDesignInfo"].id}/supabase/authorize`,{redirectUri:t,oauthRedirectUri:wwLib.wwApiRequests._getPluginsUrl()+"/supabase/redirect"});if(!(e!=null&&e.data))throw new Error("No authorization URL returned");window.location.href=e==null?void 0:e.data},unlink(){this.changeAccessToken("")}}},f={key:0,class:"body-sm content-brand-secondary bg-brand-secondary border-brand-secondary p-2 mb-2 rounded-02"},T={class:"flex items-center"},_=["disabled"];function D(t,e,c,r,A,s){const m=u("wwEditorInputRadio"),b=u("wwEditorFormRow"),w=u("wwEditorIcon");return a(),o(l,null,[i(b,{class:"w-100"},{default:h(()=>[i(m,{class:"mb-2","model-value":s.connectionMode,choices:[{label:"Guided (recommended)",value:"oauth",default:!0},{label:"Custom",value:"custom"}],"onUpdate:modelValue":s.changeConnectionMode},null,8,["model-value","onUpdate:modelValue"])]),_:1}),s.connectionMode!=="custom"?(a(),o(l,{key:0},[s.accessToken?p("",!0):(a(),o("div",f,e[2]||(e[2]=[n("span",null,"New! Connect or create an account to enable the Back-end panel and AI assistance.",-1)]))),n("div",T,[n("button",{class:"ww-editor-button -secondary",onClick:e[0]||(e[0]=(...d)=>s.connect&&s.connect(...d)),type:"button",disabled:!!s.accessToken},[i(w,{name:"logos/supabase",class:"ww-editor-button-icon -left"}),k(" "+y(s.accessToken?"Account connected":"Connect Supabase"),1)],8,_),s.accessToken?(a(),o("button",{key:0,type:"button",class:"ww-editor-button -secondary -small -icon ml-2",onClick:e[1]||(e[1]=(...d)=>s.unlink&&s.unlink(...d))},[i(w,{name:"unbind",medium:""})])):p("",!0)])],64)):(a(),o(l,{key:1},[e[3]||(e[3]=n("div",{class:"body-sm content-secondary bg-secondary border-secondary p-2 rounded-02 mb-2"},[n("span",null,"Use this mode if you wish to connect to a self-hosted project, a local development project or don't want to connect your account")],-1)),e[4]||(e[4]=n("div",{class:"body-sm content-warning-secondary bg-warning-secondary p-2 rounded-02"},[n("span",null,"Using this mode to connect your project disables the Back-end panel and AI assistance.")],-1))],64))],64)}const E=g(v,[["render",D]]);export{E as default};
