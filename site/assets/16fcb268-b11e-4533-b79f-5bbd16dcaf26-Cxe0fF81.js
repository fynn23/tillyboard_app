import{_ as ue,c as g,o as h,a as D,F as G,r as O,n as b,b as H,d as y,e as N,t as X,w as k,f as ve,v as ge,g as he,h as j,i as w,j as P,k as fe,l as xe,m as Y,p as W}from"./main-BYESN2Bt.js";import{s as ye}from"./wwSection-CE2_hyHU.js";const me={props:{content:{type:Object,required:!0},uid:{type:String,required:!0}},emits:["trigger-event"],setup(c,{emit:l}){const v=j(()=>!1),n=w(null),d=w([]),B=w(!1),t=w(null),r=w(null),M=w({x:0,y:0}),T=w(null),F=w({width:0,height:0}),V=w({x:0,y:0}),A=w(null),p=w(null),U=j(()=>{var i;if(!n.value)return{x:0,y:0};const e=n.value.getBoundingClientRect(),o=((i=c.content)==null?void 0:i.gridSize)||50;return{x:Math.floor(e.width/o),y:Math.floor(e.height/o)}}),{value:q,setValue:J}=wwLib.wwVariable.useComponentVariable({uid:c.uid,name:"items",type:"array",defaultValue:[]});P(q,e=>{JSON.stringify(e)!==JSON.stringify(d.value)&&(d.value=e)},{immediate:!0}),P(d,e=>{J(e),l("trigger-event",{name:"change",event:{items:e}})},{deep:!0});const K=j(()=>{var e,o,i,a,s,u;return{backgroundColor:((e=c.content)==null?void 0:e.backgroundColor)||"#f5f5f5",backgroundImage:(o=c.content)!=null&&o.backgroundPattern?`url(${c.content.backgroundPattern})`:"none",minHeight:((i=c.content)==null?void 0:i.minHeight)||"300px",borderRadius:((a=c.content)==null?void 0:a.borderRadius)||"8px",border:(s=c.content)!=null&&s.showBorder?`1px solid ${((u=c.content)==null?void 0:u.borderColor)||"#ddd"}`:"none",position:"relative"}}),Q=e=>{const o={left:`${e.x}px`,top:`${e.y}px`,zIndex:e.id===t.value?10:1};return(e.type==="image"||e.type==="color")&&(o.width=`${e.width}px`),e.type==="color"&&(o.height=`${e.height||100}px`),o},Z=e=>({color:e.textColor||"#000000",fontSize:`${e.fontSize||16}px`,fontWeight:e.fontWeight||"normal",fontStyle:e.fontStyle||"normal",textAlign:e.textAlign||"left",width:`${e.width||200}px`,height:e.height?`${e.height}px`:"auto",backgroundColor:"transparent",border:"none",resize:"none",overflow:"hidden",fontFamily:e.fontFamily||"inherit"}),_=(e,o)=>{var a,s;if(!((a=c.content)!=null&&a.snapToGrid))return{x:e,y:o};const i=((s=c.content)==null?void 0:s.gridSize)||50;return{x:Math.round(e/i)*i,y:Math.round(o/i)*i}},$=e=>{B.value=!0},ee=e=>{B.value=!1,e.dataTransfer.files&&e.dataTransfer.files.length>0&&te(e.dataTransfer.files)},te=e=>{v.value||Array.from(e).forEach(o=>{if(!o.type.match("image.*"))return;const i=new FileReader;i.onload=a=>{var R;const s=n.value?n.value.getBoundingClientRect():{width:400,height:400},u=s.width/2-100,f=s.height/2-100,m=(R=c.content)!=null&&R.snapToGrid?_(u,f):{x:u,y:f},x={id:Y(),type:"image",src:a.target.result,x:m.x,y:m.y,width:200};d.value=[...d.value,x],z(x.id),l("trigger-event",{name:"upload",event:{item:x}})},i.readAsDataURL(o)})},ne=(e,o)=>{if(v.value)return;e.preventDefault(),z(o.id),r.value=o;const i=e.clientX||e.touches&&e.touches[0].clientX,a=e.clientY||e.touches&&e.touches[0].clientY;i&&a&&(M.value={x:i-o.x,y:a-o.y},document.addEventListener("mousemove",E),document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("mouseup",S),document.addEventListener("touchend",S))},E=e=>{var a;if(!r.value)return;e.preventDefault();const o=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;if(o&&i&&n.value){const s=n.value.getBoundingClientRect();let u=o-s.left-M.value.x,f=i-s.top-M.value.y;if((a=c.content)!=null&&a.snapToGrid){const x=_(u,f);u=x.x,f=x.y}const m=d.value.map(x=>x.id===r.value.id?{...x,x:u,y:f}:x);d.value=m}},S=()=>{r.value&&(l("trigger-event",{name:"move",event:{item:r.value}}),r.value=null),document.removeEventListener("mousemove",E),document.removeEventListener("touchmove",E),document.removeEventListener("mouseup",S),document.removeEventListener("touchend",S)},oe=(e,o)=>{v.value||(e.preventDefault(),e.stopPropagation(),T.value=o,F.value={width:o.width||200,height:o.height||100},V.value={x:e.clientX||e.touches&&e.touches[0].clientX,y:e.clientY||e.touches&&e.touches[0].clientY},document.addEventListener("mousemove",L),document.addEventListener("touchmove",L,{passive:!1}),document.addEventListener("mouseup",I),document.addEventListener("touchend",I))},L=e=>{var a,s;if(!T.value)return;e.preventDefault();const o=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;if(o&&i){const u=o-V.value.x,f=i-V.value.y;let m=Math.max(50,F.value.width+u),x=Math.max(50,F.value.height+f);if((a=c.content)!=null&&a.snapToGrid){const C=((s=c.content)==null?void 0:s.gridSize)||50;m=Math.round(m/C)*C,x=Math.round(x/C)*C}const R=d.value.map(C=>C.id===T.value.id?{...C,width:m,height:x}:C);d.value=R}},I=()=>{T.value&&(l("trigger-event",{name:"resize",event:{item:T.value}}),T.value=null),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L),document.removeEventListener("mouseup",I),document.removeEventListener("touchend",I)},ie=e=>{v.value||(A.value=e.id,xe(()=>{if(p.value&&Array.isArray(p.value)){const o=p.value[0];o&&typeof o.focus=="function"&&(o.focus(),o.select())}else p.value&&typeof p.value.focus=="function"&&(p.value.focus(),p.value.select())}))},z=e=>{v.value||(t.value=e)},le=()=>{t.value=null,A.value=null},re=e=>{if(v.value)return;const o=d.value.find(i=>i.id===e);d.value=d.value.filter(i=>i.id!==e),t.value=null,l("trigger-event",{name:"delete",event:{item:o}})},ae=()=>{v.value||(d.value=[],t.value=null,l("trigger-event",{name:"reset",event:{}}))},se=()=>{var u;if(v.value)return;const e=n.value?n.value.getBoundingClientRect():{width:400,height:400},o=e.width/2-100,i=e.height/2-25,a=(u=c.content)!=null&&u.snapToGrid?_(o,i):{x:o,y:i},s={id:Y(),type:"text",text:"Double-click to edit text",x:a.x,y:a.y,width:200,fontSize:16,textColor:"#000000",fontWeight:"normal",fontStyle:"normal",textAlign:"left",fontFamily:"Arial"};d.value=[...d.value,s],z(s.id),l("trigger-event",{name:"addText",event:{item:s}})},de=()=>{var u,f;if(v.value)return;const e=n.value?n.value.getBoundingClientRect():{width:400,height:400},o=e.width/2-75,i=e.height/2-75,a=(u=c.content)!=null&&u.snapToGrid?_(o,i):{x:o,y:i},s={id:Y(),type:"color",color:((f=c.content)==null?void 0:f.defaultColorField)||"#3498db",x:a.x,y:a.y,width:150,height:150};d.value=[...d.value,s],z(s.id),l("trigger-event",{name:"addColorField",event:{item:s}})},ce=e=>{if(!e)return;const o=new Image;o.onload=()=>{var m;const i=n.value?n.value.getBoundingClientRect():{width:400,height:400},a=i.width/2-100,s=i.height/2-100,u=(m=c.content)!=null&&m.snapToGrid?_(a,s):{x:a,y:s},f={id:Y(),type:"image",src:e,x:u.x,y:u.y,width:200};d.value=[...d.value,f],z(f.id)},o.src=e};return fe(()=>{document.removeEventListener("mousemove",E),document.removeEventListener("touchmove",E),document.removeEventListener("mouseup",S),document.removeEventListener("touchend",S),document.removeEventListener("mousemove",L),document.removeEventListener("touchmove",L),document.removeEventListener("mouseup",I),document.removeEventListener("touchend",I)}),{canvasRef:n,canvasItems:d,isDraggingOver:B,selectedItemId:t,editingTextId:A,textEditor:p,canvasStyle:K,gridLinesCount:U,getItemStyle:Q,getTextStyle:Z,onDragOver:$,onDrop:ee,startDrag:ne,onCanvasClick:le,selectItem:z,deleteItem:re,resetCanvas:ae,addImage:ce,addText:se,addColorField:de,editText:ie,finishTextEdit,startResize:oe,isEditing:v}}},we={key:0,class:"grid-lines"},ke={class:"upload-content"},pe={class:"upload-text"},Ce={class:"upload-subtext"},be=["onMousedown","onTouchstart","onClick"],Te=["src"],Ee=["onDblclick"],Se={key:0},Le=["onUpdate:modelValue"],Ie={key:3,class:"item-controls"},ze=["onClick","title"],De=["onMousedown","onTouchstart"],_e={key:2,class:"canvas-controls"},Be=["title"];function Re(c,l,v,n,d,B){return h(),g("div",{class:"interactive-canvas",style:b(n.canvasStyle),onDragover:l[5]||(l[5]=k((...t)=>n.onDragOver&&n.onDragOver(...t),["prevent"])),onDrop:l[6]||(l[6]=k((...t)=>n.onDrop&&n.onDrop(...t),["prevent"])),onClick:l[7]||(l[7]=(...t)=>n.onCanvasClick&&n.onCanvasClick(...t)),ref:"canvasRef"},[v.content.showGrid?(h(),g("div",we,[(h(!0),g(G,null,O(n.gridLinesCount.x,t=>(h(),g("div",{key:`x-${t}`,class:"grid-line vertical",style:b({left:`${t*v.content.gridSize}px`})},null,4))),128)),(h(!0),g(G,null,O(n.gridLinesCount.y,t=>(h(),g("div",{key:`y-${t}`,class:"grid-line horizontal",style:b({top:`${t*v.content.gridSize}px`})},null,4))),128))])):D("",!0),n.canvasItems.length?D("",!0):(h(),g("div",{key:1,class:H(["upload-zone",{"drag-over":n.isDraggingOver}])},[y("div",ke,[l[8]||(l[8]=N('<div class="upload-icon" data-v-d932153e><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d932153e><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-d932153e></path><polyline points="17 8 12 3 7 8" data-v-d932153e></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-d932153e></line></svg></div>',1)),y("p",pe,X(v.content.uploadText),1),y("p",Ce,X(v.content.uploadSubtext),1)])],2)),(h(!0),g(G,null,O(n.canvasItems,t=>(h(),g("div",{key:t.id,class:H(["canvas-item",{selected:n.selectedItemId===t.id,"image-item":t.type==="image","text-item":t.type==="text","color-item":t.type==="color"}]),style:b(n.getItemStyle(t)),onMousedown:r=>n.startDrag(r,t),onTouchstart:r=>n.startDrag(r,t),onClick:k(r=>n.selectItem(t.id),["stop"])},[t.type==="image"?(h(),g("img",{key:0,src:t.src,alt:"Canvas image"},null,8,Te)):t.type==="text"?(h(),g("div",{key:1,class:"text-content",style:b(n.getTextStyle(t)),onDblclick:r=>n.editText(t)},[n.editingTextId!==t.id?(h(),g("div",Se,X(t.text),1)):ve((h(),g("textarea",{key:1,ref_for:!0,ref:r=>{r&&(n.textEditor.value=r)},"onUpdate:modelValue":r=>t.text=r,onBlur:l[0]||(l[0]=(...r)=>n.finishTextEdit&&n.finishTextEdit(...r)),onKeydown:l[1]||(l[1]=he((...r)=>n.finishTextEdit&&n.finishTextEdit(...r),["enter"])),style:b(n.getTextStyle(t))},null,44,Le)),[[ge,t.text]])],44,Ee)):t.type==="color"?(h(),g("div",{key:2,class:"color-content",style:b({backgroundColor:t.color})},null,4)):D("",!0),n.selectedItemId===t.id?(h(),g("div",Ie,[y("button",{class:"control-button delete-button",onClick:k(r=>n.deleteItem(t.id),["stop"]),title:v.content.deleteButtonText},l[9]||(l[9]=[N('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d932153e><polyline points="3 6 5 6 21 6" data-v-d932153e></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-d932153e></path><line x1="10" y1="11" x2="10" y2="17" data-v-d932153e></line><line x1="14" y1="11" x2="14" y2="17" data-v-d932153e></line></svg>',1)]),8,ze),t.type==="color"||t.type==="text"?(h(),g("div",{key:0,class:"resize-handle",onMousedown:k(r=>n.startResize(r,t),["stop"]),onTouchstart:k(r=>n.startResize(r,t),["stop"])},null,40,De)):D("",!0)])):D("",!0)],46,be))),128)),n.canvasItems.length>0?(h(),g("div",_e,[y("button",{class:"control-button add-text-button",onClick:l[2]||(l[2]=k((...t)=>n.addText&&n.addText(...t),["stop"])),title:"Add Text"},l[10]||(l[10]=[y("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[y("polyline",{points:"4 7 4 4 20 4 20 7"}),y("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),y("line",{x1:"12",y1:"4",x2:"12",y2:"20"})],-1)])),y("button",{class:"control-button add-color-button",onClick:l[3]||(l[3]=k((...t)=>n.addColorField&&n.addColorField(...t),["stop"])),title:"Add Color Field"},l[11]||(l[11]=[y("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[y("circle",{cx:"12",cy:"12",r:"10"}),y("circle",{cx:"12",cy:"12",r:"6"})],-1)])),y("button",{class:"reset-button",onClick:l[4]||(l[4]=k((...t)=>n.resetCanvas&&n.resetCanvas(...t),["stop"])),title:v.content.resetButtonText},X(v.content.resetButtonText),9,Be)])):D("",!0)],36)}const Xe=ue(me,[["render",Re],["__scopeId","data-v-d932153e"]]);W.component("wwobject-a66db6c1-6260-4d97-9f48-c866b882b7d8",Xe);W.component("section-99586bd3-2b15-4d6b-a025-6a50d07ca845",ye);
